(function(root) {
	const locales = {
		de: {
			abbreviationOfTheNewLanguage: "Abkürzung für die neue Sprache",
			aceKeybindings: "Ace Editor Tastenkürzel",
			adding: "Füge hinzu:",
			addNewLanguage: "Neue Sprache",
			all: "Alle",
			arrayBuffer8: "8bit Array-Buffer",
			arrayBuffer16: "16bit Array-Buffer",
			assets: "Assets",
			assetsAsVar: "Als Variable",
			atTime: "um",
			attentionAllContentOfTheCurrentProjectWillBeDeletedContinue: "ACHTUNG!\n\nAlle Inhalte des aktuellen Projektes werden gelöscht!\n\nFortfahren?",
			auto: "Automatisch",
			autoRenderingHasDisabled: "Autorendering wurde deaktiviert, bitte vor dem erneuten Rendern die neuen Dateien prüfen!",
			beautify: "Beautify",
			both: "Beides",
			buildingZipArchive: "Erstelle Zip-Archiv",
			cancel: "Abbrechen",
			chooseAll: "Alle auswählen",
			chooseProjectsToImport: "Wähle zu importierende Projekte",
			clickForFullscreen: "Doppelklick: Vollbild-Vorschau",
			clickToBeautifyEditorContent: "Klicken zum Formatieren des Codes",
			clickToChange: "Zum Ändern des Projektnamen hier klicken",
			close: "Schließen",
			compressingProject: "Komprimiere Projekt",
			copy: "Kopieren",
			created: "Erstellt",
			creatingFilesInFolder: "Erstelle Dateien im Verzeichnis",
			createDynamicallyHtmlSource: "Soll der Quelltext von der heruntergeladenen Datei beim Öffnen dynamisch erzeugt werden (der Quelltext wäre dann nicht direkt sichtbar)?",
			creationlistReadme: "Wichtige Information zur Datei 'creationlist.txt':\n\nDer Creator lädt alle Projekte (mit der Dateiendung '.json'),\n die sich im Unterverzeichnis 'creations/json/' befinden, automatisch in die Oberfläche,\n sofern...\n   ...er mit dem Parameter '?usedb=0' (keine Datenbank verwenden) gestartet wird, und\n   ...er die Datei 'creationlist.txt' im Verzeichnis 'creations' findet!\n\nAm einfachsten ist es, den Inhalt dieses ZIP-Archivs in das 'creations'-Verzeichnis zu kopieren.",
			ctrl: "STRG",
			cut: "Ausschneiden",
			database: "Datenbank",
			databaseBusyExplanation: "Status der Datenbank:\n  Grün: Bereit\n   Rot: Beschäftigt",
			databaseInformation: "Datenbank-Informationen",
			databaseSize: "Datenbank-Größe",
			dataUrl: "Daten-URL",
			de: "Deutsch",
			decimalSeparator: ",",
			detectUploadOnFileEnding: "Nach Datei-Endung",
			disableAutocompletion: "Keine Auto-Vervollständigung",
			download: "Download",
			downloadAsHtml: "HTML-Dokument herunterladen",
			downloadScriptsAndStyles: "Scripts und Stylesheets herunterladen",
			dynamicalHtml: "Dynamischer Quellcode",
			emptyThisProject: "Dieses Projekt leeren",
			en: "Englisch",
			enableAutocompletion: "Auto-Vervollständigung",
			enterNameForProject: "Bitte einen Namen für das Projekt angeben",
			fetchingCreationsFromFiles: "Lade Dateiliste von lokalen Projekten...",
			fileAdded: "Datei eingefügt",
			filesAdded: "Dateien eingefügt",
			filesize: "Dateigröße",
			fixedHtml: "Normaler Quellcode",
			foldAll: "Alles einklappen",
			fullNameOfTheNewLanguage: "Wie heißt die neue Sprache?",
			getWebsite: "Web-Adresse eingeben",
			images: "Bilder",
			import: "Importieren",
			importAll: "Alle importieren",
			importing: "Importiere",
			importingProject: "Importiere Projekt",
			initializingDatabase: "Initialisiere Datenbank",
			lastEdited: "zuletzt bearbeitet",
			lastEdit: "Geändert",
			load: "Laden",
			loadingDatabase: "Lade Projekte aus der Datenbank",
			loadingProject: "Lade Projekt",
			loadingZip: "Lade Zip-Archiv",
			loadProject: "Projekt(e) laden",
			localProjectsFound: "Lokale Projekte gefunden",
			minify: "Minify",
			name: "Name",
			never: "Nie",
			newProject: "Neues Projekt",
			nl: "Niederländisch",
			none: "keine",
			none2: "nichts",
			notEditedJet: "noch nicht bearbeitet",
			nothingToRemove: "Es ist nichts zum Entfernen vorhanden",
			numberDaysAgo: "vor {{days}} Tagen",
			of: "von",
			ok: "Ok",
			onDay: "am",
			oneMomentPlease: "Einen Augenblick bitte",
			onlyData: "Nur Daten (json)",
			openCommandPallete: "Kommandos anzeigen",
			paste: "Einfügen",
			pleaseEnterAddress: "Bitte die Adresse der Website eingeben",
			preventPotientiallyHarmfulContentFromRunning: "Potentiell schädliche Inhalte unterdrücken",
			project: "Projekt",
			projects: "Projekte",
			projectAlreadyExistsOverwriteProject: "Ein Projekt namens \"{{projectname}}\" ist bereits vorhanden!\nÜberschreiben?",
			projectAsWebsite: "Projekte als Webseiten (html)",
			projectsAvailable: "Projekte",
			projectCreatedOn: "Projekt erstellt am",
			projectPlural: "e",
			projectSelection: "Projekt-Auswahl",
			projectSize: "Projekt-Größe",
			projectsSuccesfullyImported: "Projekte erfolgreich importiert.",
			redo: "Wiederherstellen",
			rememberChoiceForAllFiles: "Auf alle Uploads anwenden",
			remove: "Entfernen",
			removeComments: "Kommentare entfernen",
			removeCommentsStroked: "Kommentare",
			removeLanguage: "Sprache entfernen",
			removeProjectFromDatabase: "Projekt von Datenbank löschen",
			resetDrag: "Positionen zurücksetzen",
			run: "Ausführen",
			save: "Speichern",
			saveAsDataUri: "Als Base64 Data-Uri speichern",
			saveAsText: "Als Text speichern",
			saveDatabase: "Datenbank sichern",
			saveDatabaseAsZip: "Datenbank als zip-Datei herunterladen",
			saveName: "Name speichern",
			saveProject: "Projekt sichern",
			saveUploadsAsText: "Alle Dateien als Text hinzufügen?",
			selectAll: "Alles auswählen",
			selectProject: "Projekt wählen",
			size: "Größe",
			shouldUploadsGoToTheAssetEditor: "Soll die Datei <font size=4><u>%file%</u></font> als Assets behandelt, oder entsprechend der Datei-Endungen im jeweiligen Editor abgelegt werden?",
			showDatabaseEntries: "Datenbank-Einträge anzeigen",
			showKeyboardShortcuts: "Tastaturkürzel anzeigen",
			showSettingsMenu: "Einstellungen öffnen",
			text: "Text",
			timeForCompressingDatabase: "Das komprimieren der Daten dauerte {{time}} Sekunden",
			titleAssetsAsVar: "Erstellt die globale Variable _assets_, über die Zugriff auf die Assets besteht.",
			titleFoldAllButton: "Klappt alle eingeklammerten Bereiche zu",
			titleOpenExtern: "In externem Fenster/Tab öffnen",
			titleShowAceKeybindings: "Öffnet eine Liste mit allen Tastenkürzeln für den Editor",
			titleStartNewProject: "Legt ein neues Projekt an.\nDu musst einen Projektnamen vergeben,\ndamit das Projekt in die Datenbank aufgenommen wird.\n\nOb das Projekt sich bereits in der Datenbank befindet,\nerkennst du an der Farbe des Projektnamen:\n  Rot = ungespeichert\n  Grün = Projekt ist in der Datenbank eingetragen und der\n         aktuelle Zustand ist gespeichert.",
			titleSaveAs: "Wähle, ob hochzuladende Dateien als Text, Array-Buffer oder Data-Uri gespeichert werden sollen.\nBei 'AUTO' wird nach Dateiinhalt entschieden.",
			titleSaveProject: "Lädt das aktuelle Projekt als json-Datei herunter.",
			titleLoadProject: "Lädt entweder eine json-Projekt-Datei in die\nDatenbank und öffnet sie dann, oder lädt\nein zip-Archiv, das mehrere Projekte enthalten kann.\nIm letzten Fall werden die enthaltenen Projekte angezeigt\nund du kannst wählen, welche du in die Datenbank übernehmen willst.",
			titleReset: "Leert die Inhalte aller Editoren des aktuellen Projektes.",
			titleRun: "Aktualisiert die Vorschau.\nDoppelklicken zum de-/aktivieren der automatischen Aktualisierung.",
			titleDownloadAsHtml: "Speichert das aktuelle Projekt als html-Dokument.",
			titleRemoveCommentsButton: "Alle Kommentare im aktuellen Editorfenster entfernen",
			titleRemoveProjectFromDatabase: "Schließt das aktuelle Projekt und entfernt es aus der Datenbank.\n\nACHTUNG!\nDiese Aktion läßt sich nicht rückgängig machen!",
			titleReplaceButton: "Suchen und ersetzen",
			titleSaveDatabaseAsZip: "Erstellt ein zip-Archiv, das alle Projekte enthält\n(wahlweise als json-Projektdateien, als html-Dokumente oder Beides).",
			titleSearchButton: "Suchen",
			titleGetWebsite: "Öffnet ein Eingabefeld zum Eingeben einer Web-Adresse.\nDer html-Inhalt dieser Adresse wird im html-Editor angezeigt.\nFalls die Site Inline-Styles oder -Skripte enthält,\nwerden diese in die entsprechenden Editoren\ngeladen und aus dem html-Quellcode entfernt.",
			titleUnfoldAllButton: "Alle gefalteten Bereiche ausklappen.",
			titleUploadFile: "Datei(en) wählen und zum Projekt hinzufügen.",
			titleToggleAutorun: "Automatische Aktualisierung der Vorschau aktivieren oder deaktivieren.",
			titleLoadButton: "Lädt zuvor gesicherten Inhalt von der Local Storage.",
			titleSaveButton: "Sichert den Inhalt dieses Editors in der Local Storage.",
			titleMinifyButton: "Code-Minifizierung/-Kompression\nKomprimiert den Code in diesem Editor in der Regel auf eine einzige Zeile.\nDer minifizierte Code benötigt bis zu 50% weniger Speicherplatz.\n\nVerwendete Code-Minifizierer:\nHTML: HTML-Minifier-Terser\nCSS: CleanCSS\nJavascript: Terser",
			titleBeautifyButton: "Der Beautifier formatiert den (auch minifizierten) Code,\num die Lesbarkeit zu verbessern und um Änderungen zu vereinfachen.\n\nVerwendete Beautifier:\nHTML, CSS, Javascript: JS_Beautify",
			titleUndoButton: "Dieser Button macht Änderungen am Code rückgängig.",
			titleUnfoldAllButton: "Klappt alle eingeklammerten Bereiche auf",
			titleRedoButton: "Dieser Button stellt rückgängig gemachte Änderungen am Code wieder her.",
			theZipFile: "der Zip-Datei",
			thisProjectWillBeRemovedFromDatabase: "Dieses Projekt wird aus der Datenbank gelöscht!",
			today: "heute",
			toggleAutorun: "Auto-Render an/aus",
			twoDaysAgo: "vorgestern",
			undo: "Rückgängig",
			unfoldAll: "Alles ausklappen",
			unnamed: "Unbenannt",
			unnamedProject: "Unbenanntes Projekt",
			upload: "Hochladen von Dateien",
			uploadAsAsset: "Als Asset einfügen",
			uploadFile: "Datei(en) zum Projekt hinzufügen",
			uploadFilesAs: "Dateien hochladen als...",
			waitForZipCreationToFinish: "Bitte warte damit, bis die ZIP-Erstellung abgeschlossen ist!",
			whatShouldBeSaved: "<span style='font-size: 14px'><b>Wichtiger Hinweis:</b><br>Je nach Projekt- und Datenbank-Größe kann es passieren, dass die App scheinbar stillsteht. Bitte etwas Geduld, das Komprimieren in Javascript ist rechenintensiv!</span><br><br>Was soll gespeichert werden?",
			workingOnProject: "Bearbeite Projekt",
			yesterday: "gestern",
			zipArchiveHasBeenCreated: "Das Zip-Archiv wurde erfolgreich erstellt.",
			zipArchivesHaveBeenCreated: "%num% Zip-Archive wurden erfolgreich erstellt."
		}, en: {
			abbreviationOfTheNewLanguage: "Abbreviation of the new language",
			aceKeybindings: "Ace editor keybindings",
			adding: "Adding",
			addNewLanguage: "Customize",
			all: "All",
			arrayBuffer8: "8bit array buffer",
			arrayBuffer16: "16bit array buffer",
			assets: "Assets",
			assetsAsVar: "As variable",
			atTime: "at",
			attentionAllContentOfTheCurrentProjectWillBeDeletedContinue: "ATTENTION!\n\nAll contents of the current project will be deleted!\n\nContinue?",
			auto: "Auto",
			autoRenderingHasDisabled: "Autorendering has disabled, please check the added files before rerendering!",
			beautify: "Beautify",
			both: "Both",
			buildingZipArchive: "Creating zip archive",
			cancel: "Cancel",
			chooseAll: "Choose all",
			chooseProjectsToImport: "Choose projects to import",
			clickForFullscreen: "Doubleclick: Preview in fullscreen",
			clickToBeautifyEditorContent: "Click to beautify editor contents",
			clickToChange: "Click to change project name",
			close: "Close",
			compressingProject: "Compressing project",
			copy: "Copy",
			created: "Created",
			creatingFilesInFolder: "Creating files in folder",
			createDynamicallyHtmlSource: "Should the source code of the downloaded file be generated dynamically when it is opened (the source code would then not be directly visible)?",
			creationlistReadme: "Important information about the 'creationlist.txt' file:\n\nThe Creator automatically loads all projects (with the file extension '.json')\n located in the 'creations/json/' subdirectory into the interface,\n if...\n   ...the tool was started with '?usedb=0' as search parameter (no use of database) and\n   ...it finds the 'creationlist.txt' file in the 'creations' directory!\n\nThe easiest way is to copy the contents of this ZIP archive to the 'creations' directory.",
			ctrl: "CTRL",
			cut: "Cut",
			database: "Database",
			databaseBusyExplanation: "State of the database:\n  Green: Idle\n    Red: Busy",
			databaseInformation: "Database Information",
			databaseSize: "Database size",
			dataUrl: "Data URL",
			de: "German",
			decimalSeparator: ".",
			detectUploadOnFileEnding: "By file ending",
			disableAutocompletion: "Disable autocompletion",
			download: "Download",
			downloadAsHtml: "Download HTML document",
			downloadScriptsAndStyles: "Download scripts and stylesheets",
			dynamicalHtml: "Dynamic source code",
			emptyThisProject: "Empty this project",
			en: "English",
			enableAutocompletion: "Enable autocompletion",
			enterNameForProject: "Please enter a name for the project",
			fetchingCreationsFromFiles: "Loading filelist of local projects...",
			fileAdded: "file added",
			filesAdded: "files added",
			filesize: "File size",
			fixedHtml: "Normal source code",
			foldAll: "Fold all",
			fullNameOfTheNewLanguage: "Full name of the new language",
			getWebsite: "Enter web address",
			images: "Images",
			import: "Import",
			importAll: "Import all",
			importing: "Importing",
			importingProject: "Importing projekt",
			initializingDatabase: "Initializing database",
			lastEdit: "Last edit",
			lastEdited: "last edited",
			load: "Load",
			loadingDatabase: "Loading projects from database",
			loadingProject: "Loading project",
			loadingZip: "Loading zip archive",
			loadProject: "Load project/s",
			localProjectsFound: "Local projects found",
			minify: "Minify",
			name: "Name",
			never: "Never",
			newProject: "New project",
			nl: "Dutch",
			none: "no",
			none2: "none",
			notEditedJet: "not edited jet",
			nothingToRemove: "Nothing to remove",
			numberDaysAgo: "{{days}} days ago",
			of: "of",
			ok: "Ok",
			onDay: "on",
			oneMomentPlease: "One moment please",
			onlyData: "Only data (json)",
			openCommandPallete: "Open command pallete",
			paste: "Paste",
			pleaseEnterAddress: "Please enter the address of a website",
			preventPotientiallyHarmfulContentFromRunning: "Suppress potentially harmful content",
			project: "Project",
			projects: "Projekts",
			projectAlreadyExistsOverwriteProject: "A project named \"{{projectname}}\" already exists!\nOverwrite?",
			projectAsWebsite: "Projects as websites (html)",
			projectsAvailable: "Projects",
			projectCreatedOn: "Project created on",
			projectPlural: "s",
			projectSelection: "Project selection",
			projectSize: "Project size",
			projectsSuccesfullyImported: "Projects succesfully imported.",
			redo: "Redo",
			rememberChoiceForAllFiles: "Remember choice for all files",
			remove: "Remove",
			removeComments: "Remove comments",
			removeCommentsStroked: "Comments",
			removeLanguage: "Remove language",
			removeProjectFromDatabase: "Remove project from database",
			resetDrag: "Reset positions",
			run: "Run",
			save: "Save",
			saveAsDataUri: "Save as data uri",
			saveAsText: "Save as text",
			saveDatabase: "Save database",
			saveDatabaseAsZip: "Download database as zip",
			saveName: "Save name",
			saveProject: "Save project",
			saveUploadsAsText: "Add all files as text?",
			selectAll: "Select all",
			selectProject: "Select project",
			size: "Size",
			shouldUploadsGoToTheAssetEditor: "Should the file <font size=4><u>%file%</u></font> be treated as assets, or should they be stored in the respective editor according to the file extensions?",
			showDatabaseEntries: "Show database entries",
			showKeyboardShortcuts: "Show keyboard shortcuts",
			showSettingsMenu: "show settings menu",
			text: "Text",
			timeForCompressingDatabase: "It took {{time}} seconds to compress the database",
			titleAssetsAsVar: "Creates the global variable _assets_, which gives you access to the assets.",
			titleFoldAllButton: "Folds all areas",
			titleOpenExtern: "Open in external window/tab",
			titleShowAceKeybindings: "Show a list of all available keybindings for the editor",
			titleStartNewProject: "Creates a new project.\nYou must assign a project name to include\nthe project to the database.\nYou can tell whether the project is already in\nthe database by the color of the project name:\n  Red = unsaved\n  Green = project is part of the database and the current status is saved.",
			titleSaveAs: "Choose whether files to be uploaded should be saved as text, array buffer or data Uri.\nWith 'AUTO' the decision is made based on the file content.",
			titleSaveProject: "Downloads the current project as a json file.",
			titleLoadProject: "Either loads a json project file into the database\nand then opens it, or loads a zip archive\nthat can contain multiple projects.\nIn the latter case, the included projects are displayed\nand you can choose which ones to add to the database.",
			titleReset: "Clears the contents of all editors of the current project.",
			titleRun: "Refreshes the preview. Double-click to toggle automatic refresh.",
			titleDownloadAsHtml: "Save the current project as an html document.",
			titleRemoveCommentsButton: "Remove all comments in this editor window.",
			titleRemoveProjectFromDatabase: "Close the current project and remove it from the database.\n\nWARNING!\nThis action cannot be undone!",
			titleReplaceButton: "Find and replace",
			titleSaveDatabaseAsZip: "Creates a zip archive containing all projects\n(either as json project files, as html documents or both).",
			titleSearchButton: "Find",
			titleGetWebsite: "Opens an input field for entering a web address.\nThe html content of this address is displayed in the html editor.\nIf the site contains inline styles or scripts, they are\nloaded into the appropriate editors and\nare removed from the html source code.",
			titleUnfoldAllButton: "Unfold all folded sections.",
			titleUploadFile: "Select file(s) to add to the project.",
			titleToggleAutorun: "Enable or disable automatic preview update.",
			titleLoadButton: "Loads content from the local storage that was previous saved there.",
			titleSaveButton: "Saves the content of this editor to the local storage.",
			titleMinifyButton: "Code minification/compression\nCompresses the code in this editor, typically to a single line.\nThe minified code requires up to 50% less memory.\n\nCode minifiers used:\nHTML: HTML-Minifier-Terser\nCSS: CleanCSS\nJavascript: Terser",
			titleBeautifyButton: "The beautifier formats the (also minified) code,\nto improve readability and to simplify changes.\n\nBeautifiers used:\nHTML, CSS, Javascript: JS_Beautify",
			titleUndoButton: "This button undoes code changes.",
			titleUnfoldAllButton: "Unfolds all areas",
			titleRedoButton: "This button restores undone changes to code.",
			theZipFile: "of the zip archive",
			thisProjectWillBeRemovedFromDatabase: "This project will be removed from the database!",
			today: "today",
			toggleAutorun: "Toggle auto render",
			twoDaysAgo: "two days ago",
			undo: "Undo",
			unnamed: "Unnamed",
			unnamedProject: "Unnamed Project",
			unfoldAll: "Unfold all",
			upload: "Upload of files",
			uploadAsAsset: "Paste as Asset",
			uploadFilesAs: "Upload files as...",
			uploadFile: "Add file/s to project",
			whatShouldBeSaved: "Attention! Depending on the size of the database, the app<br> may freeze temporarily. Please be patient, compression<br> in JavaScript is computationally intensive!<br><br>What should be saved?",
			waitForZipCreationToFinish: "Please wait until the zip creation has been finished!",
			workingOnProject: "Adding project",
			yesterday: "yesterday",
			zipArchiveHasBeenCreated: "The zip archive has been created successfully.",
			zipArchivesHaveBeenCreated: "%num% zip archives have been created successfully."
		}
	};

	let resolve;
	const div = document.createElement("div");
	div.className = "modal";
	div.id = "modal-language";
	document.body.append(div);
	if(window.localStorage && localStorage.creator_locals) {
		const l = JSON.parse(localStorage.creator_locals);

		l.languages && Object.keys(l.languages).forEach(key => locales[key] = l.languages[key]);

		l.additions && l.additions.forEach(({ loc, obj }) => {
			for(key in obj) locales[key][loc] = obj[key];
		});
	}

	function htmlChars(str) {
		return str.replace(/</g, "&lt;").replace(/>/g, "&gt;");
	}

	function processLanguageAddForm() {
	    let items = document.querySelectorAll(".language-add-input");
	    let short = document.querySelector(".language-add-short").value;
	    let name = document.querySelector(".language-add-long").value;
	    let l = { [short]: {} }, ls;
	    let keys = Object.keys(locales[locale.active]);
	    items.forEach(item => {
	        let index = Number(item.dataset.index);
	        let value = item.value || item.placeholder;
	        l[short][keys[index]] = value;
	    });
		keys.forEach(key => l[short][key] == null && (l[short][key] = locales[locale.active][key]));
	    locales[short] = l[short];
		let obj = {}, loc = short;
	    locale.available.push(short);
		locale.available.forEach(key => {
		    locales[key][short] = name;
			obj[key] = name;
		});
		if(window.localStorage){
		    ls = localStorage.creator_locals ? JSON.parse(localStorage.creator_locals) : {};
			ls.additions = ls.additions  || [];
			ls.additions.push({ loc, obj });
			ls.languages = ls.languages || {};
			ls.languages[short] = l[short];
		    localStorage.creator_locals = JSON.stringify(ls);
		}
	    div.style.opacity = 0;
	    setTimeout(() => {
	        div.style.display = "none";
	        div.innerHTML = "";
	    },400);
		resolve && resolve(locale.available);
	}

	function cancelLanguageForm() {
	    div.style.opacity = 0;
	    setTimeout(() => {
	        div.style.display = "none";
	        div.innerHTML = "";
	    },400);
		resolve && resolve(0);
	}

	function processLanguageRemoveForm() {
		const toRemove = [...document.querySelectorAll(".language-remove")].filter(e => e.checked);
		if (toRemove.length) {
			ls = JSON.parse(localStorage.creator_locals);
			toRemove.forEach(item => {
				let [additions] = ls.additions.filter(e => e.loc === item.value);
				Object.keys(additions.obj).forEach(addition => delete locales[addition][additions.loc]);
				delete locales[additions.loc];
				delete ls.languages[additions.loc];
				locale.available.splice(locale.available.indexOf(additions.loc), 1);
				ls.additions.splice(ls.additions.indexOf(additions), 1);
				localStorage.creator_locals = JSON.stringify(ls);
			});
		}
		div.style.opacity = 0;
		setTimeout(() => {
			div.style.display = "none";
			div.innerHTML = "";
		},400);
		if (resolve) resolve(locale.available);
		else return locale.available;
	}

	const locale = {
		available: Object.keys(locales),
		active: "en",
		set(lang) {
			locale.active = lang || (navigator.language || navigator.userLanguage || navigator.browserLanguage).substring(0, 2);
			locales[locale.active] || (locale.active = "en");
			return locales[locale.active];
		},
		showAddForm(active) {
			active = active || locale.active;
			return new Promise(res => {
				resolve = res;
				const lang = locales[active];
			    let list = `
				<div class='language-container'>
					<h1>${lang.addNewLanguage}</h1>
					<br>
					<span style='display: block; width: 100%; margin: 4px;'>
						<label style='display: block; margin: 5px 0 0 5px; font-size: 12px; font-weight: bold;'>${lang.fullNameOfTheNewLanguage}</label>
						<span style='display: block; width:90%;'>
							<input type='text' class='language-add-long'>
						</span>
					</span>
					<span style='display: block; width: 100%; margin: 4px;'>
						<label style=''>${lang.abbreviationOfTheNewLanguage}</label>
						<span style='display: block; width:90%;'>
							<input type='text' class='language-add-short'>
						</span>
					</span>`;
			    Object.keys(lang).forEach((key, index) => {
			        list += `
					<span style='display: block; width: 100%; margin: 4px;'>
						<label style='display: block; margin: 5px 0 0 5px; vertical-align: top; white-space: wrap;'>${key}</label>
						<span style='display: block; width:90%; vertical-align: top;'>
							<input type='text' class='language-add-input' data-index='${index}' placeholder='${htmlChars(lang[key])}'>
						</span>
					</span>`;
			    });
			    list += `
				</div>
				<div class='add-lang-buttons flex-space-evenly'>
					<input type='button' id='add-lang' value='${lang.save}'>
					<input type='button' id='add-lang-cancel' value='${lang.cancel}'>
				</div>`;
			    div.innerHTML = list;
			    div.style.display = "block";
			    div.style.opacity = 1;
		        document.querySelector("#add-lang").onclick = processLanguageAddForm;
		        document.querySelector("#add-lang-cancel").onclick = cancelLanguageForm;
			});
		},
		showRemovable(active) {
			active = active || locale.active;
			const lang = locales[active];
			return new Promise(res => {
				resolve = res;
				let list = `
				<div class='language-container'>
					<h1>${lang.removeLanguage}</h1>
					<br>`;
				if(root.localStorage && root.localStorage.creator_locals) {
					const l = JSON.parse(root.localStorage.creator_locals);

					if (l.languages && Object.keys(l.languages).length) {
						Object.keys(l.languages).forEach(key => {
					   		list += `
		   			<div style="margin: 4px; padding: 15px;">${key}
		   				<input type="checkbox" class="language-remove" value="${key}"> ${lang.remove}
		   			</div>`;
				   		});
						list += `
				</div>
				<div class='add-lang-buttons flex-space-evenly'>
					<input type='button' id='add-lang' value='${lang.remove}'>
					<input type='button' id='add-lang-cancel' value='${lang.cancel}'>
				</div>`;
					} else {
						list += `
					<div style='margin: 4px;'>${lang.nothingToRemove}</div>
				<div class='add-lang-buttons flex-space-evenly'>
					<input type='button' id='add-lang-cancel' value='${lang.cancel}'>
				</div>`;
					}
					div.innerHTML = list;
	 			    div.style.display = "block";
	 			    div.style.opacity = 1;
	 			    if (list.split("type='button'").length === 3) document.querySelector("#add-lang").onclick = processLanguageRemoveForm;
	 			    document.querySelector("#add-lang-cancel").onclick = cancelLanguageForm;
					l.additions && l.additions.forEach(({ loc, obj }) => {
						for(key in obj) {
							locales[key][loc] = obj[key];
						}
					});
				}
			});
		}
	};

	root.locale = locale;

})(globalThis);
